<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dramaku App</title>
    <style>
        :root { --primary: #e50914; --bg: #0f0f0f; }
        
        /* FIX ZOOM & Kerapian Standar */
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        body { background-color: var(--bg); color: white; font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; overflow-x: hidden; padding-bottom: 60px; }
        
        /* Navbar Atas */
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: rgba(0,0,0,0.95); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #222; }
        .navbar-brand { color: var(--primary); font-size: 24px; font-weight: 900; letter-spacing: 2px; text-transform: uppercase; cursor: pointer; }
        .search-container { display: flex; gap: 8px; flex: 1; justify-content: flex-end;}
        .search-box { padding: 8px 15px; border-radius: 20px; border: 1px solid #444; background: rgba(255,255,255,0.1); color: white; outline: none; width: 100%; max-width: 200px; }
        .search-btn { background: var(--primary); color: white; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }

        .view-section { display: none; }
        
        /* Loader Layar Penuh */
        #globalLoader { position: fixed; inset: 0; background: var(--bg); z-index: 9999; flex-direction: column; justify-content: center; align-items: center; }
        .loader-logo { font-size: 2.5rem; font-weight: 900; color: var(--primary); letter-spacing: 5px; animation: pulse 0.8s infinite alternate; }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9); } 100% { opacity: 1; transform: scale(1.1); text-shadow: 0 0 20px rgba(229, 9, 20, 0.8); } }

        /* Hero Banner (Beranda) */
        .hero { height: 50vh; background-size: cover; background-position: center; position: relative; display: flex; align-items: flex-end; padding: 30px 20px; transition: background-image 0.5s ease-in-out;}
        .hero::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, var(--bg) 5%, rgba(0,0,0,0.2) 50%, rgba(0,0,0,0.8) 100%); }
        .hero-content { position: relative; z-index: 5; width: 100%; }
        .hero-title { font-size: 2rem; font-weight: 900; margin-bottom: 5px; text-shadow: 2px 2px 5px #000; }
        .hero-desc { font-size: 0.95rem; line-height: 1.4; margin-bottom: 15px; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; color: #ddd; text-shadow: 1px 1px 3px #000;}
        .info-btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid #fff; padding: 8px 20px; border-radius: 5px; font-weight: bold; cursor: pointer; -webkit-backdrop-filter: blur(5px); backdrop-filter: blur(5px); }

        /* Slider Film */
        .row { padding: 15px 20px 5px 20px; }
        .row h2 { font-size: 1.1rem; margin-bottom: 10px; color: #fff; font-weight: bold; border-left: 3px solid var(--primary); padding-left: 8px;}
        .row-posters { display: flex; overflow-x: auto; gap: 12px; padding-bottom: 10px; }
        .row-posters::-webkit-scrollbar { display: none; }
        
        .poster-card { width: 110px; flex-shrink: 0; cursor: pointer; }
        
        /* üî• EFEK SKELETON LOADING üî• */
        .poster-box { 
            width: 100%; padding-top: 150%; position: relative; border-radius: 8px; overflow: hidden; 
            background: linear-gradient(90deg, #1a1a1a 25%, #2a2a2a 50%, #1a1a1a 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            box-shadow: 0 4px 8px rgba(0,0,0,0.5);
        }
        @keyframes shimmer { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }
        
        .poster-box img { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s ease-in-out; }
        .poster-box img.loaded { opacity: 1; }

        /* Grid Layout (Jelajah & Riwayat) */
        .page-container { padding: 20px; min-height: 100vh; }
        .page-header { font-size: 1.5rem; border-left: 4px solid var(--primary); padding-left: 10px; margin-bottom: 20px; }
        .sort-select { background: #222; color: white; border: 1px solid #444; padding: 10px; border-radius: 5px; width: 100%; outline: none; margin-bottom: 10px;}
        
        .grid-container { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        @media (max-width: 400px) { .grid-container { grid-template-columns: repeat(2, 1fr); } }
        .grid-item { width: 100%; display: flex; flex-direction: column; cursor: pointer;}
        .grid-item p { text-align: center; margin-top: 8px; font-size: 0.8rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: #ccc; }

        /* Pagination Ala Google */
        .pagination { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 8px; margin: 20px 0; }
        .page-num { padding: 8px 12px; background: #222; border-radius: 5px; color: white; cursor: pointer; font-weight: bold; font-size: 0.9rem; border: 1px solid #333;}
        .page-num.active { background: var(--primary); border-color: var(--primary); }
        .page-btn { padding: 8px 15px; background: #111; border: 1px solid #444; border-radius: 5px; color: white; cursor: pointer; font-weight: bold;}

        /* Detail View VIP */
        #detailView { min-height: 100vh; position: relative; background-size: cover; background-position: center; background-attachment: fixed; transition: background-image 0.5s ease-in-out;}
        #detailView::before { content: ''; position: absolute; inset: 0; background: rgba(0,0,0,0.85); -webkit-backdrop-filter: blur(8px); backdrop-filter: blur(8px); z-index: 1; }
        .back-nav { position: relative; z-index: 20; padding: 15px 20px; font-size: 1.1rem; color: #aaa; font-weight: bold; cursor: pointer;}
        .detail-content { position: relative; z-index: 20; padding: 0 20px 20px 20px; }
        
        .detail-title { font-size: 2rem; font-weight: 900; margin-bottom: 10px; line-height: 1.1;}
        .detail-meta { color: #aaa; font-size: 0.9rem; margin-bottom: 15px; display: flex; gap: 10px; align-items: center; }
        .rating-badge { background: var(--primary); color: white; padding: 3px 8px; border-radius: 4px; font-weight: bold; }
        .detail-overview { font-size: 0.95rem; line-height: 1.5; color: #eee; margin-bottom: 25px; }
        
        /* 2 Poster Interaktif */
        .action-posters { display: flex; gap: 15px; justify-content: flex-start; margin-bottom: 20px;}
        .action-card { width: 130px; aspect-ratio: 2/3; border-radius: 8px; overflow: hidden; position: relative; border: 2px solid transparent; box-shadow: 0 5px 15px rgba(0,0,0,0.8); cursor: pointer;}
        .action-card img { width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: opacity 0.5s ease-in-out;}
        .action-card img.loaded { opacity: 1; }
        .action-card::after { content: ''; position: absolute; inset: 0; background: linear-gradient(to top, rgba(0,0,0,0.9), transparent 60%); }
        .action-card .label { position: absolute; bottom: 12px; left: 0; width: 100%; text-align: center; font-size: 0.85rem; font-weight: bold; color: white; z-index: 2; }
        .card-movie { border-color: var(--primary); }
        .card-trailer { border-color: #555; }
        
        /* Katalog Rekomendasi (Z-Index di Atas Blur) */
        .related-section { position: relative; z-index: 20; padding-bottom: 80px; }
        .related-section h2 { margin-left: 20px; color: white; font-weight: bold; font-size: 1.2rem; border-left: 3px solid var(--primary); padding-left: 10px; margin-bottom: 15px; }

        /* Modal Player (Sandbox Sudah Dicabut) */
        #playerModal { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; flex-direction: column; }
        .player-header { padding: 15px; display: flex; justify-content: space-between; background: #111; border-bottom: 1px solid var(--primary);}
        .server-selector { background: #222; color: white; padding: 8px; border-radius: 5px; border: 1px solid #444; outline: none; font-weight: bold;}
        #playerModal iframe { width: 100%; flex: 1; border: none; }
        .close-btn { font-size: 25px; color: #fff; line-height: 1; font-weight: bold; cursor: pointer;}

        /* Bottom Navigation Modern */
        .bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(10,10,10,0.98); border-top: 1px solid #222; display: flex; justify-content: space-around; z-index: 1000; -webkit-backdrop-filter: blur(10px); backdrop-filter: blur(10px);}
        .nav-item { flex: 1; text-align: center; padding: 18px 0; font-size: 0.8rem; font-weight: 800; color: #666; letter-spacing: 1px; transition: 0.3s; border-top: 3px solid transparent; cursor: pointer;}
        .nav-item.active { color: white; border-top: 3px solid var(--primary); background: linear-gradient(to top, rgba(229,9,20,0.1), transparent); }
    </style>
</head>
<body>

    <div class="navbar" id="topNavbar">
        <div class="navbar-brand" onclick="navigateTo('home')">DRAMAKU</div>
        <div class="search-container">
            <input type="text" id="searchInput" class="search-box" placeholder="Cari film...">
            <button class="search-btn" onclick="executeSearch()">Cari</button>
        </div>
    </div>

    <div id="globalLoader" class="view-section">
        <div class="loader-logo">DRAMAKU</div>
    </div>

    <div id="homeView" class="view-section">
        <div id="hero" class="hero">
            <div class="hero-content">
                <h1 class="hero-title" id="heroTitle">Memuat...</h1>
                <p class="hero-desc" id="heroDesc">Menyinkronkan...</p>
                <button class="info-btn" id="heroPlayBtn">Lihat Detail</button>
            </div>
        </div>
        <div class="row"><h2>Sedang Trending</h2><div class="row-posters" id="row-trending"></div></div>
        <div class="row"><h2>Action Super Tegang</h2><div class="row-posters" id="row-action"></div></div>
        <div class="row"><h2>Horor Bikin Merinding</h2><div class="row-posters" id="row-horror"></div></div>
        <div class="row"><h2>Komedi Bikin Ngakak</h2><div class="row-posters" id="row-comedy"></div></div>
    </div>

    <div id="exploreView" class="view-section page-container">
        <h2 id="exploreTitle" class="page-header">Jelajah Film</h2>
        <select id="sortSelect" class="sort-select" onchange="applySort()">
            <option value="popularity.desc">Paling Banyak Ditonton</option>
            <option value="vote_average.desc">Rating Tertinggi</option>
            <option value="primary_release_date.desc">Terbaru Dirilis</option>
        </select>
        <div class="pagination" id="paginationTop"></div>
        <div class="grid-container" id="exploreGrid"></div>
        <div class="pagination" id="paginationBottom"></div>
    </div>

    <div id="historyView" class="view-section page-container">
        <h2 class="page-header">Riwayat Tontonan</h2>
        <div class="grid-container" id="historyGrid"></div>
    </div>

    <div id="detailView" class="view-section">
        <div class="back-nav" onclick="goBack()">‚ùÆ KEMBALI</div>
        <div class="detail-content">
            <h1 class="detail-title" id="detTitle">Memuat...</h1>
            <div class="detail-meta">
                <span class="rating-badge" id="detRating">0.0</span>
                <span id="detYear">N/A</span>
            </div>
            <div class="action-posters">
                <div class="action-card card-movie" onclick="startPlayback('movie')">
                    <img id="cardMovieImg" src="" onload="this.classList.add('loaded')" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'; this.classList.add('loaded');">
                    <div class="label">‚ñ∂ FULL MOVIE</div>
                </div>
                <div class="action-card card-trailer" id="trailerCard" onclick="startPlayback('trailer')">
                    <img id="cardTrailerImg" src="" onload="this.classList.add('loaded')" onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'; this.classList.add('loaded');">
                    <div class="label">üé¨ TRAILER</div>
                </div>
            </div>
            <p class="detail-overview" id="detDesc">Menarik sinopsis...</p>
        </div>
        <div class="related-section">
            <h2>Rekomendasi Serupa</h2>
            <div class="row-posters" id="row-related"></div>
        </div>
    </div>

    <div id="playerModal">
        <div class="player-header">
            <select class="server-selector" id="serverSelect" onchange="changeServer()">
                <option value="vidsrc">Server 1 (Prioritas)</option>
                <option value="vidlink">Server 2 (Cadangan)</option>
            </select>
            <span class="close-btn" onclick="closePlayer()">‚úñ</span>
        </div>
        <iframe id="videoIframe" src="" allowfullscreen></iframe>
    </div>

    <div class="bottom-nav" id="bottomNav">
        <div class="nav-item active" id="nav-home" onclick="navigateTo('home')">BERANDA</div>
        <div class="nav-item" id="nav-explore" onclick="navigateTo('explore', {mode: 'popular'})">JELAJAH</div>
        <div class="nav-item" id="nav-history" onclick="navigateTo('history')">RIWAYAT</div>
    </div>

    <script>
        const API_KEY = '5c9e36288ce1ccb6f161f613f06b190e';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMG_URL = 'https://image.tmdb.org/t/p/w500';

        let currentExploreMode = 'popular'; 
        let currentSort = 'popularity.desc';
        let searchQuery = '';
        let currentPage = 1;
        let totalPages = 1;
        let activeMovieId = null;
        let activeTrailerKey = null;

        function showSection(sectionId) {
            document.querySelectorAll('.view-section').forEach(el => el.style.display = 'none');
            document.getElementById(sectionId).style.display = (sectionId === 'globalLoader') ? 'flex' : 'block';
            document.getElementById('topNavbar').style.display = (sectionId === 'detailView' || sectionId === 'globalLoader') ? 'none' : 'flex';
            document.getElementById('bottomNav').style.display = (sectionId === 'detailView' || sectionId === 'globalLoader') ? 'none' : 'flex';
            if(sectionId !== 'globalLoader') window.scrollTo(0, 0);
        }

        function updateBottomNav(page) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            if(['home', 'explore', 'history'].includes(page)) {
                document.getElementById('nav-' + page).classList.add('active');
            }
        }

        function navigateTo(page, params = {}, pushState = true) {
            if (pushState) history.pushState({ page, params }, '', `#${page}`);
            updateBottomNav(page);
            if (page === 'home') showSection('homeView');
            else if (page === 'explore') openExplore(params.mode || 'popular', params.page || 1, params.query || '');
            else if (page === 'history') loadHistory();
            else if (page === 'detail') loadMovieDetail(params.id);
        }

        // LOGIKA BACK BUTTON ANTI-NYASAR
        window.addEventListener('popstate', function(e) {
            if (document.getElementById('playerModal').style.display === 'flex') {
                closePlayer();
                history.replaceState({ page: 'detail', id: activeMovieId }, '', '#detail');
                return;
            }
            if (!e.state && document.getElementById('detailView').style.display === 'block') {
                history.replaceState({ page: 'detail', id: activeMovieId }, '', '#detail');
                return;
            }
            if (e.state && e.state.page) navigateTo(e.state.page, e.state.params, false);
            else navigateTo('home', {}, false);
        });

        function createPosterHTML(movie) {
            return `
                <div class="poster-box">
                    <img src="${IMG_URL + movie.poster_path}" loading="lazy" 
                         onload="this.classList.add('loaded')" 
                         onerror="this.src='https://via.placeholder.com/300x450?text=No+Poster'; this.classList.add('loaded');">
                </div>
                <p>${movie.title}</p>
            `;
        }

        async function initHome() {
            try {
                const resHero = await fetch(`${BASE_URL}/trending/movie/week?api_key=${API_KEY}&language=id-ID`);
                const dataHero = await resHero.json();
                const heroMovie = dataHero.results[0];
                
                const heroImg = new Image();
                heroImg.src = `https://image.tmdb.org/t/p/original${heroMovie.backdrop_path}`;
                heroImg.onload = () => {
                    document.getElementById('hero').style.backgroundImage = `url(${heroImg.src})`;
                };
                
                document.getElementById('heroTitle').innerText = heroMovie.title;
                document.getElementById('heroDesc').innerText = heroMovie.overview;
                document.getElementById('heroPlayBtn').onclick = () => navigateTo('detail', { id: heroMovie.id });

                fetchRow(`${BASE_URL}/trending/movie/day?api_key=${API_KEY}&language=id-ID`, 'row-trending');
                fetchRow(`${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=28&language=id-ID&sort_by=popularity.desc`, 'row-action');
                fetchRow(`${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=27&language=id-ID&sort_by=popularity.desc`, 'row-horror');
                fetchRow(`${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=35&language=id-ID&sort_by=popularity.desc`, 'row-comedy');
            } catch(e) {}
        }

        async function fetchRow(url, rowId) {
            const res = await fetch(url);
            const data = await res.json();
            const row = document.getElementById(rowId);
            row.innerHTML = '';
            data.results.forEach(movie => {
                if(movie.poster_path) {
                    const div = document.createElement('div');
                    div.className = 'poster-card';
                    div.onclick = () => navigateTo('detail', { id: movie.id });
                    div.innerHTML = createPosterHTML(movie);
                    row.appendChild(div);
                }
            });
        }

        function executeSearch() {
            const query = document.getElementById('searchInput').value.trim();
            if(!query) return;
            navigateTo('explore', { mode: 'search', query: query, page: 1 });
        }

        function applySort() {
            currentSort = document.getElementById('sortSelect').value;
            navigateTo('explore', { mode: 'popular', page: 1 });
        }

        async function openExplore(mode, pageNum, query) {
            showSection('globalLoader');
            currentExploreMode = mode;
            currentPage = pageNum;
            if (query) searchQuery = query;

            let url = '';
            if (mode === 'popular') {
                document.getElementById('exploreTitle').innerText = 'Jelajah Film';
                document.getElementById('sortSelect').style.display = 'block';
                let extraParam = currentSort === 'vote_average.desc' ? '&vote_count.gte=200' : '';
                url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&language=id-ID&sort_by=${currentSort}${extraParam}&page=${currentPage}`;
            } else {
                document.getElementById('exploreTitle').innerText = `Hasil: "${searchQuery}"`;
                document.getElementById('sortSelect').style.display = 'none';
                url = `${BASE_URL}/search/movie?api_key=${API_KEY}&language=id-ID&query=${encodeURIComponent(searchQuery)}&page=${currentPage}`;
            }

            try {
                const res = await fetch(url);
                const data = await res.json();
                totalPages = Math.min(data.total_pages, 500); 
                
                renderPagination();

                const grid = document.getElementById('exploreGrid');
                grid.innerHTML = '';
                data.results.forEach(movie => {
                    if(movie.poster_path) {
                        const div = document.createElement('div');
                        div.className = 'grid-item';
                        div.onclick = () => navigateTo('detail', { id: movie.id });
                        div.innerHTML = createPosterHTML(movie);
                        grid.appendChild(div);
                    }
                });
                showSection('exploreView');
            } catch (err) { showSection('exploreView'); }
        }

        function renderPagination() {
            if (totalPages <= 1) {
                document.getElementById('paginationTop').innerHTML = '';
                document.getElementById('paginationBottom').innerHTML = '';
                return;
            }

            let html = '';
            if (currentPage > 1) html += `<button class="page-btn" onclick="changePage(-1)">‚ùÆ</button>`;
            
            let startPage = Math.max(1, currentPage - 2);
            let endPage = Math.min(totalPages, currentPage + 2);

            if (startPage > 1) {
                html += `<div class="page-num" onclick="goToPage(1)">1</div>`;
                if (startPage > 2) html += `<span style="color:#666; font-weight:bold;">...</span>`;
            }

            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) html += `<div class="page-num active">${i}</div>`;
                else html += `<div class="page-num" onclick="goToPage(${i})">${i}</div>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) html += `<span style="color:#666; font-weight:bold;">...</span>`;
                html += `<div class="page-num" onclick="goToPage(${totalPages})">${totalPages}</div>`;
            }

            if (currentPage < totalPages) html += `<button class="page-btn" onclick="changePage(1)">‚ùØ</button>`;

            document.getElementById('paginationTop').innerHTML = html;
            document.getElementById('paginationBottom').innerHTML = html;
        }

        function changePage(direction) { goToPage(currentPage + direction); }
        function goToPage(page) {
            if (page >= 1 && page <= totalPages && page !== currentPage) {
                navigateTo('explore', { mode: currentExploreMode, query: searchQuery, page: page });
            }
        }

        function saveToHistory(movie) {
            let history = JSON.parse(localStorage.getItem('dramaku_history')) || [];
            history = history.filter(m => m.id !== movie.id);
            history.unshift({ id: movie.id, title: movie.title, poster_path: movie.poster_path });
            if (history.length > 30) history.pop();
            localStorage.setItem('dramaku_history', JSON.stringify(history));
        }

        function loadHistory() {
            showSection('globalLoader');
            const history = JSON.parse(localStorage.getItem('dramaku_history')) || [];
            const grid = document.getElementById('historyGrid');
            grid.innerHTML = '';
            
            if(history.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #888;">Belum ada riwayat tontonan.</p>';
            } else {
                history.forEach(movie => {
                    const div = document.createElement('div');
                    div.className = 'grid-item';
                    div.onclick = () => navigateTo('detail', { id: movie.id });
                    div.innerHTML = createPosterHTML(movie);
                    grid.appendChild(div);
                });
            }
            showSection('historyView');
        }

        async function loadMovieDetail(tmdbId) {
            showSection('globalLoader');
            try {
                let res = await fetch(`${BASE_URL}/movie/${tmdbId}?api_key=${API_KEY}&language=id-ID`);
                let movie = await res.json();
                
                if (!movie.overview || movie.overview.trim() === '') {
                    let resEn = await fetch(`${BASE_URL}/movie/${tmdbId}?api_key=${API_KEY}&language=en-US`);
                    let movieEn = await resEn.json();
                    movie.overview = movieEn.overview || "Sinopsis tidak tersedia.";
                }
                
                activeMovieId = movie.id;
                saveToHistory(movie);

                const bgImg = new Image();
                bgImg.src = `https://image.tmdb.org/t/p/original${movie.backdrop_path}`;
                bgImg.onload = () => { document.getElementById('detailView').style.backgroundImage = `url(${bgImg.src})`; };
                
                document.getElementById('detTitle').innerText = movie.title;
                document.getElementById('detRating').innerText = `‚≠ê ${movie.vote_average.toFixed(1)}`;
                document.getElementById('detYear').innerText = movie.release_date ? movie.release_date.substring(0,4) : '';
                document.getElementById('detDesc').innerText = movie.overview;
                
                const coverImg = document.getElementById('cardMovieImg');
                coverImg.src = `${IMG_URL}${movie.poster_path}`;

                let resVid = await fetch(`${BASE_URL}/movie/${tmdbId}/videos?api_key=${API_KEY}`);
                let vidData = await resVid.json();
                
                activeTrailerKey = null;
                const trailerCard = document.getElementById('trailerCard');
                if (vidData.results && vidData.results.length > 0) {
                    let trailer = vidData.results.find(v => v.type === 'Trailer' && v.site === 'YouTube') || vidData.results.find(v => v.site === 'YouTube');
                    if (trailer) {
                        activeTrailerKey = trailer.key;
                        const tImg = document.getElementById('cardTrailerImg');
                        tImg.src = `https://img.youtube.com/vi/${trailer.key}/hqdefault.jpg`;
                        trailerCard.style.display = 'block';
                    } else { trailerCard.style.display = 'none'; }
                } else { trailerCard.style.display = 'none'; }

                fetchRow(`${BASE_URL}/movie/${tmdbId}/similar?api_key=${API_KEY}&language=id-ID`, 'row-related');

                showSection('detailView');
            } catch (err) {}
        }

        function goBack() { history.back(); }

        let currentPlayType = 'movie';
        function startPlayback(type) {
            history.pushState({ page: 'player' }, '', '#player');
            
            currentPlayType = type;
            const modal = document.getElementById('playerModal');
            const iframe = document.getElementById('videoIframe');
            const selector = document.getElementById('serverSelect');
            
            modal.style.display = 'flex';
            
            if (modal.requestFullscreen) modal.requestFullscreen();
            else if (modal.webkitRequestFullscreen) modal.webkitRequestFullscreen();

            if (type === 'trailer') {
                selector.style.display = 'none';
                iframe.src = `https://www.youtube.com/embed/${activeTrailerKey}?autoplay=1`;
            } else {
                selector.style.display = 'block';
                selector.value = 'vidsrc';
                changeServer(); 
            }
        }

        function changeServer() {
            if (currentPlayType !== 'movie' || !activeMovieId) return;
            const server = document.getElementById('serverSelect').value;
            const iframe = document.getElementById('videoIframe');
            iframe.src = server === 'vidlink' 
                ? `https://vidlink.pro/movie/${activeMovieId}` 
                : `https://vidsrc.me/embed/movie?tmdb=${activeMovieId}`;
        }

        function closePlayer() {
            document.getElementById('playerModal').style.display = 'none';
            document.getElementById('videoIframe').src = '';
            if (document.exitFullscreen) document.exitFullscreen();
        }

        initHome();
        navigateTo('home', {}, false);
        document.getElementById('searchInput').addEventListener('keypress', e => { if (e.key === 'Enter') executeSearch(); });
    </script>
</body>
</html>
