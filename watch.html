<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nonton Dramaku</title>
    <style>
        body { margin: 0; background-color: #000; color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        video { width: 100%; height: 100%; object-fit: contain; }
        .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; z-index: 10; pointer-events: none; }
    </style>
</head>
<body>

    <div class="loading" id="statusMsg">
        <h2>üîç Mencari Video...</h2>
        <small id="debugInfo">ID: -</small>
    </div>

    <video id="myVideo" controls autoplay playsinline poster="https://via.placeholder.com/1280x720/000000/FFFFFF/?text=Loading...">
        Browser tidak support.
    </video>

    <script>
        // 1. AMBIL ID DARI URL
        const params = new URLSearchParams(window.location.search);
        const bookId = params.get('id');
        const episode = params.get('ep') || "1"; // Default Episode 1

        const statusMsg = document.getElementById('statusMsg');
        const debugInfo = document.getElementById('debugInfo');
        const videoPlayer = document.getElementById('myVideo');

        debugInfo.innerText = "ID: " + bookId + " | Eps: " + episode;

        // 2. FUNGSI UTAMA: AMBIL DATA DARI JSON
        async function loadVideo() {
            try {
                // Ambil file episodes.json
                const response = await fetch('episodes.json?v=' + new Date().getTime()); // Pake time biar gak kena cache
                const data = await response.json();

                // Cari Film berdasarkan ID
                const movieData = data[bookId];

                if (movieData) {
                    // Cari Episode
                    const videoUrl = movieData.episodes[episode];

                    if (videoUrl) {
                        // KETEMU! MAININ VIDEONYA
                        statusMsg.innerHTML = "<h2>‚úÖ Video Ditemukan!</h2>";
                        console.log("Memutar: " + videoUrl);
                        
                        videoPlayer.src = videoUrl;
                        videoPlayer.play().catch(e => console.log("Butuh play manual"));
                        
                        // Sembunyikan pesan loading setelah 1 detik
                        setTimeout(() => { statusMsg.style.display = 'none'; }, 1000);

                    } else {
                        statusMsg.innerHTML = "<h2 style='color:red'>‚ùå Episode Belum Rilis</h2>";
                    }
                } else {
                    statusMsg.innerHTML = "<h2 style='color:red'>‚ùå Film Tidak Ditemukan</h2><p>ID Salah / Belum Terdaftar</p>";
                }

            } catch (error) {
                console.error(error);
                statusMsg.innerHTML = "<h2 style='color:red'>‚ö†Ô∏è Error Koneksi</h2>";
            }
        }

        // Jalankan Fungsi
        if(bookId) {
            loadVideo();
        } else {
            statusMsg.innerHTML = "<h2>‚õî ID Tidak Valid</h2>";
        }
    </script>
</body>
</html>
